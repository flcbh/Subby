@using Subby.Blazor.Maui.ViewComponents
@using Subby.Core.Entities
@using LastContent.Utilities.Extensions
@model LastContent.Utilities.Pagination.PagedResult<Advert>
@{
    ViewData["Title"] = "My Ads";
}
<div class="header">
    <div class="container">
        <div class="row">
            <div class="col-5">
                <div class="greetings">
                    <img src="~/images/icons/logo.png" alt="SubbyNetwork" class="logo"/>
                    <div class="greeting-body small">
                        <p>Welcome to</p>
                        <h2>Sustainability Yard</h2>
                    </div>
                </div>
            </div>
            <div class="col-7 ml-auto text-right">
                <a href="" onclick="return false;" class="user-icon" data-toggle="modal" data-target="#sideMenuModal">
                    <i class="nav-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" class="bi bi-list" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"/>
                        </svg>
                    </i>
                    <span>Menu</span>
                </a>
                <a asp-controller="Chats" asp-action="Index" class="user-icon">
                    <i class="nav-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" class="bi bi-chat" viewBox="0 0 16 16">
                          <path d="M2.678 11.894a1 1 0 0 1 .287.801 10.97 10.97 0 0 1-.398 2c1.395-.323 2.247-.697 2.634-.893a1 1 0 0 1 .71-.074A8.06 8.06 0 0 0 8 14c3.996 0 7-2.807 7-6 0-3.192-3.004-6-7-6S1 4.808 1 8c0 1.468.617 2.83 1.678 3.894zm-.493 3.905a21.682 21.682 0 0 1-.713.129c-.2.032-.352-.176-.273-.362a9.68 9.68 0 0 0 .244-.637l.003-.01c.248-.72.45-1.548.524-2.319C.743 11.37 0 9.76 0 8c0-3.866 3.582-7 8-7s8 3.134 8 7-3.582 7-8 7a9.06 9.06 0 0 1-2.347-.306c-.52.263-1.639.742-3.468 1.105z"/>
                        </svg>
                    </i>
                    <span>Messages</span>
                </a>
                <a asp-controller="Adverts" asp-action="Manage" class="user-icon">
                    <i class="nav-icon">
                        <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-card-checklist" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M14.5 3h-13a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h13a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5zm-13-1A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-13z"/>
                            <path fill-rule="evenodd" d="M7 5.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm-1.496-.854a.5.5 0 0 1 0 .708l-1.5 1.5a.5.5 0 0 1-.708 0l-.5-.5a.5.5 0 1 1 .708-.708l.146.147 1.146-1.147a.5.5 0 0 1 .708 0zM7 9.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm-1.496-.854a.5.5 0 0 1 0 .708l-1.5 1.5a.5.5 0 0 1-.708 0l-.5-.5a.5.5 0 0 1 .708-.708l.146.147 1.146-1.147a.5.5 0 0 1 .708 0z"/>
                        </svg>
                    </i>
                    <span>My Ads</span>
                </a>
            </div>
        </div>
        <div class="clearfix"></div>
    </div>
</div>
<div class="container">
    <div class="card mt-3">
        <div class="card-body">
            <h1 class="subtitle mt-4 text-center">You have <strong>@Model.Items.Count</strong> ads posted</h1>
            <p class="text-center">Use the button below to create more advert!</p>
            <a asp-controller="Adverts" class="float" asp-action="New">
                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-plus" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                </svg>
            </a>
        </div>
    </div>
    <div class="jobs-wrapper mb-5 pb-5">
      
        <div class="row">
            @foreach (var item in Model.Items)
            {
                <div class="col-md-12 col-lg-6">
                    <div class="card advert-card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-3">
                                    @if (item.MediaCollection.Any())
                                    {
                                        <img src="@item.MediaCollection.FirstOrDefault()?.Src.Replace("/upload", "/upload/c_scale,w_120")" alt="@item.Title"/>
                                    }
                                    else
                                    {
                                        <img src="https://app.subbynetwork.com/images/icons/logo.png" alt="@item.Title" class="avatar default"/>
                                    }
                                </div>
                                <div class="col-6">
                                    <h2>@Html.Raw(item.Title.Truncate(35))</h2>
                                    <p class="tag">Posted: @item.CreatedAt.ToTimeAgo()</p>
                                    <p class="tag">Location: @item.Location</p>
                                </div>
                                <div class="col-3">
                                    <div class="price-tag">
                                        <span>Price:</span> @(item.IsFree ? "Free" : item.Price)
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr />
                        <div class="card-body advert-stats">
                            <p class="mb-0">Posted <strong>@item.CreatedAt.ToTimeAgo()</strong></p>
                            <p class="mb-0">Update: <a asp-controller="Adverts" asp-action="edit" asp-route-id="@item.Id">Click here</a></p>
                            <p class="mb-0">Status: 
                                @if (item.IsSold)
                                {
                                    <span class="text-success">
                                        <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-check2-circle" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                            <path fill-rule="evenodd" d="M15.354 2.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3-3a.5.5 0 1 1 .708-.708L8 9.293l6.646-6.647a.5.5 0 0 1 .708 0z"/>
                                            <path fill-rule="evenodd" d="M8 2.5A5.5 5.5 0 1 0 13.5 8a.5.5 0 0 1 1 0 6.5 6.5 0 1 1-3.25-5.63.5.5 0 1 1-.5.865A5.472 5.472 0 0 0 8 2.5z"/>
                                        </svg>  
                                        Sold
                                    </span>
                                }
                                else
                                {
                                    <a href="" onclick="PositionFilled(@item.Id); return false;">Mark as Sold</a>
                                }
                                
                            </p>
                        </div>
                    </div>
                </div>
            }
       </div>
        <div class="mt-2 mb-2">
            @(await Component.InvokeAsync<PagerViewComponent>(Model))
        </div>
    </div>
</div>
<partial name="Partials/_PartialBottomStackSupplies"/>

@section scripts
{
    <script>
        function PositionFilled(id) {
            $.ajax({
                type: "POST",
                headers: {
                    'Content-Type':'application/json'
                },
                url: '/api/adverts/filled',
                data: JSON.stringify({
                    id: id
                }),
                success: function (data) {
                    window.location.reload();
                },
                failure: function (response) {
    
                },
                error: function (response) {
               
                }
            });
        }
        
    </script>
}